<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SEITEL</title>

  <!-- Microsoft Clarity -->
  <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "vj9vufepwf");
  </script>

  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f9; text-align:center; padding:40px; }
    .contenedor { background:#fff; padding:30px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,.1); max-width:920px; margin:auto; }

    .header {
      display:grid;
      grid-template-columns: 90px 1fr 94px;
      align-items:center;
      gap:16px;
      margin-bottom: 10px;
    }

    .logo-uned { width: 90px; height: auto; justify-self:center; }
    .logo-seitel { width: 94px; height: auto; justify-self:center; }

    .header-text { text-align:center; }
    .header-text .linea1 { font-size: 20px; font-weight: bold; margin: 0; }
    .header-text .linea2 { font-size: 16px; margin: 6px 0 0; color:#333; }
    .header-text .linea3 { font-size: 15px; margin: 4px 0 0; color:#333; }

    h1 { margin: 12px 0 6px; font-size: 34px; color:#2c7be5; line-height: 1.1; }
    .seitel-tagline { display:block; font-size: 17px; font-weight: 700; margin-top: 8px; color:#2c7be5; }
    .subtitulo { margin: 14px 0 18px; color:#333; }

    .fila { margin: 14px 0; }
    select, button { padding: 10px 12px; font-size: 16px; border-radius: 6px; }
    button { border:0; background:#2c7be5; color:#fff; cursor:pointer; }
    button:hover { background:#1a5fc4; }

    .btn-link{
      display:inline-block;
      padding: 10px 14px;
      border-radius: 6px;
      background:#2c7be5;
      color:#fff;
      text-decoration:none;
      font-size: 15px;
      font-weight: 700;
    }

    .estado {
      margin-top:12px;
      font-size: 16px;
      font-weight: 700;
      color: #0B6E4F;
    }

    .caja-pregunta{
      max-width: 740px;
      margin: 10px auto 16px;
      background:#111;
      color:#fff;
      border-radius:10px;
      padding:14px 16px;
    }

    #opciones { max-width: 680px; margin: 0 auto; }

    .opcion {
      display:block;
      width:100%;
      margin:8px 0;
      border:0;
      border-radius: 6px;
      padding: 10px 12px;
      font-size: 16px;
      color:#fff;
      cursor:pointer;
      background:#2c7be5;
    }

    .feedback {
      margin: 12px auto 0;
      padding: 12px;
      border-radius: 8px;
      display:none;
      text-align:left;
      max-width: 680px;
    }

    .ok { background:#e8f7ee; }
    .ko { background:#fdeaea; }

    .footer {
      margin-top: 22px;
      padding-top: 14px;
      border-top: 2px solid #9ec5fe;
      text-align: left;
      font-size: 13px;
      color: #444;
      line-height: 1.6;
    }
  </style>
</head>

<body>
  <div class="contenedor">

    <div class="header">
      <img class="logo-uned" src="logo-uned.png" alt="Logo UNED" />
      <div class="header-text">
        <p class="linea1">UNED — Grado en Pedagogía</p>
        <p class="linea2">Asignatura: <strong>Medios, Recursos Didácticos y Tecnología Educativa</strong></p>
        <p class="linea3">Herramienta abierta de autoevaluación tipo test</p>
      </div>
      <img class="logo-seitel" src="logo-SEITEL.png" alt="Logo SEITEL" />
    </div>

    <h1>
      SEITEL
      <span class="seitel-tagline">Smart Evaluation & Innovation in Technology-Enhanced Learning</span>
    </h1>

    <p class="subtitulo">Cada práctica tiene <strong>10 preguntas</strong>. Feedback inmediato.</p>

    <div class="fila">
      <label for="seleccion"><strong>Elige práctica:</strong></label>
      <select id="seleccion"></select>
      <button onclick="iniciarPractica()">Comenzar</button>
    </div>

    <div id="panelJuego" style="display:none;">
      <div class="estado" id="estado"></div>
      <div class="caja-pregunta">
        <h3 id="enunciado"></h3>
      </div>
      <div id="opciones"></div>
      <div id="feedback" class="feedback"></div>
    </div>

    <div id="panelFinal" style="display:none; margin-top:18px;"></div>

  </div>

<script>
/* Analítica con Microsoft Clarity:
   - Pageviews automáticos
   - Evento: practice_completed
   - Evento: question_wrong (con question_id hash)
*/

let bancoTemas = {};
let practica = [];
let indice = 0;
let aciertos = 0;
let practiceCompletedSent = false;

function barajar(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function hashQuestion(str) {
  let h = 0x811c9dc5;
  for (let i = 0; i < str.length; i++) {
    h ^= str.charCodeAt(i);
    h = (h * 0x01000193) >>> 0;
  }
  return h.toString(16).substring(0, 12);
}

window.onload = function() {
  fetch("questions.json")
    .then(r => r.json())
    .then(data => {
      bancoTemas = data.temas || {};
      cargarSelector();
    });
};

function cargarSelector() {
  const sel = document.getElementById("seleccion");
  Object.keys(bancoTemas).forEach(t => {
    sel.appendChild(new Option(t, t));
  });
}

function iniciarPractica() {
  const tema = document.getElementById("seleccion").value;
  practica = barajar([...bancoTemas[tema]]).slice(0,10);
  indice = 0;
  aciertos = 0;
  practiceCompletedSent = false;
  document.getElementById("panelJuego").style.display = "block";
  mostrarPregunta();
}

function mostrarPregunta() {
  if (indice >= practica.length) {
    mostrarFinal();
    return;
  }
  const p = practica[indice];
  document.getElementById("enunciado").textContent = p.pregunta;
  const cont = document.getElementById("opciones");
  cont.innerHTML = "";
  p.opciones.forEach((op, i) => {
    const b = document.createElement("button");
    b.className = "opcion";
    b.textContent = op;
    b.onclick = () => responder(i);
    cont.appendChild(b);
  });
}

function responder(idx) {
  const p = practica[indice];
  if (idx === p.correcta) {
    aciertos++;
  } else {
    if (window.clarity) {
      const qid = hashQuestion(p.pregunta);
      window.clarity("set","question_id", qid);
      window.clarity("event","question_wrong");
    }
  }
  indice++;
  mostrarPregunta();
}

function mostrarFinal() {
  if (!practiceCompletedSent && window.clarity) {
    window.clarity("event","practice_completed");
    practiceCompletedSent = true;
  }
  document.getElementById("panelJuego").innerHTML =
    "<h2>Práctica finalizada</h2><p>Resultado: "+aciertos+"/10</p>";
}
</script>

</body>
</html>
